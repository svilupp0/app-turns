<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turni App - Login</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row bg-primary text-white py-4">
            <div class="col-12 text-center">
                <h1 class="display-4 fw-bold">Turni App</h1>
                <p class="lead">Gestione semplice dei turni di lavoro</p>
            </div>
        </div>

        <!-- Pagina Login -->
        <div id="pagina-login" class="row justify-content-center mt-5">
            <div class="col-md-6 col-lg-4">
                <div class="card shadow">
                    <div class="card-body p-5">
                        <h2 class="text-center mb-4">Accedi</h2>
                        <form id="login-form" onsubmit="effettuaLogin(event)">
                            <div class="mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="password" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">Accedi</button>
                            </div>
                        </form>
                        <hr class="my-4">
                        <div class="text-center">
                            <p class="text-muted">Non hai un account?</p>
                            <button class="btn btn-outline-secondary" onclick="mostraRegistrazione()">Registrati</button>
                        </div>
                        <hr class="my-4">
                        <div class="text-center">
                            <p class="text-muted"><small>Modalità sviluppo</small></p>
                            <button class="btn btn-outline-warning btn-sm" onclick="attivaModalitaTest()">
                                <i class="bi bi-flask"></i> Modalità Test
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagina Registrazione -->
        <div id="pagina-registrazione" class="row justify-content-center mt-5" style="display: none;">
            <div class="col-md-6 col-lg-4">
                <div class="card shadow">
                    <div class="card-body p-5">
                        <h2 class="text-center mb-4">Registrati</h2>
                        <form id="registrazione-form" onsubmit="effettuaRegistrazione(event)">
                            <div class="mb-3">
                                <label for="nome-reg" class="form-label">Nome</label>
                                <input type="text" class="form-control" id="nome-reg" required>
                            </div>
                            <div class="mb-3">
                                <label for="cognome-reg" class="form-label">Cognome</label>
                                <input type="text" class="form-control" id="cognome-reg" required>
                            </div>
                            <div class="mb-3">
                                <label for="email-reg" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email-reg" required>
                            </div>
                            <div class="mb-3">
                                <label for="password-reg" class="form-label">Password</label>
                                <input type="password" class="form-control" id="password-reg" required>
                            </div>
                            <div class="mb-3">
                                <label for="conferma-password" class="form-label">Conferma Password</label>
                                <input type="password" class="form-control" id="conferma-password" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">Registrati</button>
                            </div>
                        </form>
                        <hr class="my-4">
                        <div class="text-center">
                            <p class="text-muted">Hai già un account?</p>
                            <button class="btn btn-outline-secondary" onclick="mostraLogin()">Accedi</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagina Home -->
        <div id="pagina-home" class="row justify-content-center mt-5" style="display: none;">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow">
                    <div class="card-body p-5">
                        <h2 class="text-center mb-4">Benvenuto!</h2>
                        <p class="text-center mb-4">Che tipo di attività gestisci?</p>
                        
                        <div class="row g-3">
                            <div class="col-md-4">
                                <button class="btn btn-outline-primary w-100 h-100 py-4" onclick="selezionaAttivita('horeca')">
                                    <i class="bi bi-cup-hot display-4 d-block mb-2"></i>
                                    <strong>HORECA</strong><br>
                                    <small>Ristoranti, bar, catering, hotel...</small>
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-outline-primary w-100 h-100 py-4" onclick="selezionaAttivita('commercio')">
                                    <i class="bi bi-shop display-4 d-block mb-2"></i>
                                    <strong>Commercio</strong><br>
                                    <small>Negozi al dettaglio</small>
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-outline-primary w-100 h-100 py-4" onclick="selezionaAttivita('amministrazione')">
                                    <i class="bi bi-building display-4 d-block mb-2"></i>
                                    <strong>Amministrazione / Servizi</strong><br>
                                    <small>Uffici, studi, ecc.</small>
                                </button>
                            </div>
                        </div>

                        <!-- Sezione attività multiple (nascosta di default) -->
                        <div id="sezione-attivita-multiple" class="mt-4" style="display: none;">
                            <hr>
                            <h5>Gestisci più attività</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted">Hai altre attività da gestire?</span>
                                <button class="btn btn-sm btn-outline-secondary" onclick="aggiungiAttivita()">
                                    <i class="bi bi-plus"></i> Aggiungi attività
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagina Domande -->
        <div id="pagina-domande" class="row justify-content-center mt-5" style="display: none;">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow">
                    <div class="card-body p-5">
                        <div id="progress-container" class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span id="progress-text">Domanda 1 di 7</span>
                                <span id="progress-percentage">14%</span>
                            </div>
                            <div class="progress">
                                <div id="progress-bar" class="progress-bar" style="width: 14%"></div>
                            </div>
                        </div>

                        <div id="domanda-container">
                            <!-- Le domande verranno inserite qui dinamicamente -->
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <button id="btn-indietro" class="btn btn-outline-secondary" onclick="domandaPrecedente()" style="display: none;">
                                <i class="bi bi-arrow-left"></i> Indietro
                            </button>
                            <button id="btn-avanti" class="btn btn-primary" onclick="domandaSuccessiva()">
                                Avanti <i class="bi bi-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagina Gestione Dipendenti -->
        <div id="pagina-dipendenti" class="row mt-4" style="display: none;">
            <div class="col-12">
                <!-- Header con riepilogo -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <h2>Gestione Dipendenti</h2>
                        <p class="text-muted">
                            Tipo attività: <span id="riepilogo-tipo" class="badge bg-primary"></span> | 
                            Dipendenti configurati: <span id="riepilogo-dipendenti" class="badge bg-secondary"></span> | 
                            Tipo turni: <span id="riepilogo-turni" class="badge bg-info"></span>
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-primary" onclick="mostraFormDipendente()">
                            <i class="bi bi-plus"></i> Aggiungi Dipendente
                        </button>
                        <button class="btn btn-outline-secondary" onclick="tornaHome()">
                            <i class="bi bi-house"></i> Home
                        </button>
                    </div>
                </div>

                <!-- Statistiche -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card bg-primary text-white">
                            <div class="card-body text-center">
                                <h4 id="totale-dipendenti">0</h4>
                                <small>Totale Dipendenti</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-success text-white">
                            <div class="card-body text-center">
                                <h4 id="media-ore">0</h4>
                                <small>Media Ore Settimanali</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-info text-white">
                            <div class="card-body text-center">
                                <h4 id="totale-ore">0</h4>
                                <small>Totale Ore Settimanali</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-warning text-white">
                            <div class="card-body text-center">
                                <h4 id="scadenze-prossime">0</h4>
                                <small>Scadenze Prossime</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filtri e ricerca -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="ricerca" placeholder="Cerca dipendenti..." onkeyup="filtraDipendenti()">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="ordinamento" onchange="ordinaDipendenti()">
                            <option value="alfabetico">Ordina per: Nome A-Z</option>
                            <option value="alfabetico-desc">Ordina per: Nome Z-A</option>
                            <option value="data-assunzione">Ordina per: Data Assunzione (recente)</option>
                            <option value="data-assunzione-desc">Ordina per: Data Assunzione (vecchia)</option>
                            <option value="scadenza-contratto">Ordina per: Scadenza Contratto</option>
                            <option value="scadenza-contratto-desc">Ordina per: Scadenza Contratto (inversa)</option>
                            <option value="ore-settimanali">Ordina per: Ore Settimanali (crescente)</option>
                            <option value="ore-settimanali-desc">Ordina per: Ore Settimanali (decrescente)</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-secondary w-100" onclick="esportaDipendenti()">
                            <i class="bi bi-download"></i> Esporta
                        </button>
                    </div>
                </div>

                <!-- Tabella dipendenti -->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Nome e Cognome</th>
                                        <th>Data Assunzione</th>
                                        <th>Scadenza Contratto</th>
                                        <th>Ore Settimanali</th>
                                        <th>Ore Giornaliere</th>
                                        <th>Stato Contratto</th>
                                        <th>Azioni</th>
                                    </tr>
                                </thead>
                                <tbody id="tabella-dipendenti">
                                    <!-- I dipendenti verranno inseriti qui dinamicamente -->
                                </tbody>
                            </table>
                        </div>
                        <div id="nessun-dipendente" class="text-center py-5" style="display: none;">
                            <i class="bi bi-people display-1 text-muted"></i>
                            <h5 class="text-muted mt-3">Nessun dipendente inserito</h5>
                            <p class="text-muted">Inizia ad aggiungere i tuoi dipendenti per gestire i turni.</p>
                            <button class="btn btn-primary" onclick="mostraFormDipendente()">
                                <i class="bi bi-plus"></i> Aggiungi Primo Dipendente
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagina Dashboard (per avvii successivi) -->
        <div id="pagina-dashboard" class="row mt-4" style="display: none;">
            <div class="col-12">
                <!-- Header -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <h2>Dashboard Turni</h2>
                        <p class="text-muted">
                            Benvenuto <span id="nome-utente" class="fw-bold"></span> | 
                            Tipo attività: <span id="dashboard-tipo" class="badge bg-primary"></span> | 
                            Dipendenti: <span id="dashboard-dipendenti" class="badge bg-secondary"></span>
                            <span id="test-indicator" class="badge bg-warning ms-2" style="display: none;">
                                <i class="bi bi-flask"></i> Modalità Test
                            </span>
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-outline-secondary" onclick="logout()">
                            <i class="bi bi-box-arrow-right"></i> Logout
                        </button>
                        <button class="btn btn-outline-warning ms-2" onclick="resetModalitaTest()" title="Reset dati test">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>

                <!-- Sezione Calendario -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="bi bi-calendar-event"></i> Periodo di Programmazione</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted mb-3">Imposta il periodo per cui vuoi programmare i turni:</p>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="data-inizio" class="form-label">Data Inizio</label>
                                        <input type="date" class="form-control" id="data-inizio" onchange="aggiornaPeriodo()">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="data-fine" class="form-label">Data Fine</label>
                                        <input type="date" class="form-control" id="data-fine" onchange="aggiornaPeriodo()">
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                        <span id="periodo-info" class="text-muted">Seleziona le date per vedere il periodo</span>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-primary w-100" onclick="salvaPeriodo()">Conferma periodo</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="bi bi-chat-text"></i> Richieste del Personale</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted mb-3">Incolla qui le richieste che ti ha fatto il personale:</p>
                                
                                <textarea class="form-control" id="richieste-personale" rows="6" 
                                          placeholder="Esempio:&#10;- Mario: mi lascia libero venerdì che ho un matrimonio&#10;- Anna: ho una visita medica martedì pomeriggio&#10;- Luca: vorrei il weekend libero per un viaggio"
                                          oninput="salvaRichiesteAutomatico()"></textarea>
                                
                                <div class="mt-3">
                                    <button class="btn btn-outline-secondary" onclick="caricaRichieste()">
                                        <i class="bi bi-arrow-clockwise"></i> Carica Ultime
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sezione Azioni Rapide -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="bi bi-lightning"></i> Azioni Rapide</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-primary w-100 mb-2" onclick="generaTurniAutomatici()">
                                            <i class="bi bi-magic"></i><br>
                                            <strong>Genera Turni Automatici</strong><br>
                                            <small>Algoritmo automatico</small>
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-success w-100 mb-2" onclick="visualizzaCalendario()">
                                            <i class="bi bi-calendar-week"></i><br>
                                            <strong>Visualizza Calendario</strong><br>
                                            <small>Vista settimanale</small>
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-warning w-100 mb-2" onclick="gestisciDipendenti()">
                                            <i class="bi bi-people"></i><br>
                                            <strong>Gestisci Dipendenti</strong><br>
                                            <small>Modifica anagrafica</small>
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-info w-100 mb-2" onclick="esportaTurni()">
                                            <i class="bi bi-file-earmark-excel"></i><br>
                                            <strong>Esporta Turni</strong><br>
                                            <small>File Excel/PDF</small>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sezione Statistiche Rapide -->
                <!-- Tabella Turni Generati -->
                <div id="tabella-turni-container" class="row mt-4" style="display:none;">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="bi bi-table"></i> Tabella Turni Generati</h5>
                            </div>
                            <div class="card-body" id="tabella-turni"></div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="card bg-primary text-white">
                            <div class="card-body text-center">
                                <h4 id="totale-giorni">0</h4>
                                <small>Giorni da Programmare</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-success text-white">
                            <div class="card-body text-center">
                                <h4 id="richieste-pendenti">0</h4>
                                <small>Richieste da Gestire</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-warning text-white">
                            <div class="card-body text-center">
                                <h4 id="turni-generati">0</h4>
                                <small>Turni Generati</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Dipendente (Modal) -->
        <div id="form-dipendente" class="modal fade show" style="display: none; background-color: rgba(0,0,0,0.5);">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="form-titolo">Inserisci Nuovo Dipendente</h5>
                        <button type="button" class="btn-close" onclick="nascondiFormDipendente()"></button>
                    </div>
                    <div class="modal-body">
                        <form id="dipendente-form" onsubmit="salvaDipendente(event)">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="nome-dipendente" class="form-label">Nome *</label>
                                        <input type="text" class="form-control" id="nome-dipendente" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="cognome-dipendente" class="form-label">Cognome *</label>
                                        <input type="text" class="form-control" id="cognome-dipendente" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="data-assunzione" class="form-label">Data Assunzione *</label>
                                        <input type="date" class="form-control" id="data-assunzione" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="scadenza-contratto" class="form-label">Scadenza Contratto</label>
                                        <input type="date" class="form-control" id="scadenza-contratto">
                                        <small class="text-muted">Lascia vuoto per contratto indeterminato</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="ore-settimanali" class="form-label">Ore Settimanali da Contratto *</label>
                                        <input type="number" class="form-control" id="ore-settimanali" min="1" max="60" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="ore-giornaliere" class="form-label">Ore Giornaliere Abituali *</label>
                                        <input type="number" class="form-control" id="ore-giornaliere" min="1" max="12" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Domande condizionali -->
                            <div id="domande-condizionali" style="display: none;">
                                <hr>
                                <div id="domanda-solo" style="display: none;">
                                    <div class="mb-3">
                                        <label class="form-label">Può lavorare da solo?</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="lavoro-solo" id="solo-si" value="si">
                                            <label class="form-check-label" for="solo-si">Sì</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="lavoro-solo" id="solo-no" value="no">
                                            <label class="form-check-label" for="solo-no">No</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="domanda-preferenza" style="display: none;">
                                    <div class="mb-3">
                                        <label class="form-label">Che tipo di turno preferisce?</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="preferenza-turno" id="pref-unico" value="unico">
                                            <label class="form-check-label" for="pref-unico">Unico</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="preferenza-turno" id="pref-spezzato" value="spezzato">
                                            <label class="form-check-label" for="pref-spezzato">Spezzato</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="preferenza-turno" id="pref-entrambi" value="entrambi">
                                            <label class="form-check-label" for="pref-entrambi">Entrambi</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="nascondiFormDipendente()">Annulla</button>
                        <button type="submit" form="dipendente-form" class="btn btn-primary">Salva Dipendente</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/app.js"></script>
</body>
</html>